apiVersion: dope.metacontroller.io/v1
kind: Recipe
metadata:
  name: create-fifty-configmaps
  namespace: d-testing
spec:
  tasks:
  - name: create-fifty-configmaps
    create: 
      state: 
        kind: ConfigMap
        apiVersion: v1
        metadata:
          name: create-cm-elapsed-time
          namespace: d-testing
      replicas: 50
---
apiVersion: dope.metacontroller.io/v1
kind: Recipe
metadata:
  name: assert-creation-of-fifty-configmaps-elapsed-time
  namespace: d-testing
  labels:
    d-testing.dope.metacontroller.io/enabled: "true"
spec:
  tasks:
  - name: assert-create-fifty-configmaps-job-completed
    assert: 
      state: 
        kind: Recipe
        apiVersion: dope.metacontroller.io/v1
        metadata:
          name: create-fifty-configmaps
          namespace: d-testing
        status:
          phase: Completed
  - name: assert-creation-of-fifty-configmaps-within-time
    assert: 
      state: 
        kind: Recipe
        apiVersion: dope.metacontroller.io/v1
        metadata:
          name: create-fifty-configmaps
          namespace: d-testing
      pathCheck:
        path: status.taskListStatus.job-elapsed-time.elapsedTimeInSeconds
        pathCheckOperator: LTE
        # assert if the entire experiment of creating 50 configmaps
        # completes in around 20 seconds
        value: 20.0001
        dataType: float64
---